<% layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/stylesheets/show.css" />

<div class="white-card p-0">
  <div class="p-0">
    <div id="hotelCarousel" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-inner">
        <% hotel.images.forEach((img, i) => {%>
        <div class="carousel-item <%= i === 0 ? 'active' : '' %>">
          <img class="d-block w-100" src="<%= img.url%>" alt="hotel photo" />
        </div>
        <% }) %>
      </div>
      <% if(hotel.images.length>1) { %>
      <button
        class="carousel-control-prev"
        type="button"
        data-bs-target="#hotelCarousel"
        data-bs-slide="prev"
      >
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button
        class="carousel-control-next"
        type="button"
        data-bs-target="#hotelCarousel"
        data-bs-slide="next"
      >
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
      <% } %>
    </div>
    <!-- <div class="card">
      <% for(let img of hotel.images) {%>
      <img src="<%= img.url%>" class="card-img-top" alt="..." />
      <% } %> -->
  </div>
  <div class="d-flex justify-content-between row m-3">
    <div class="card-body col-lg-6">
      <h3 class="card-title mb-3"><%= hotel.title%></h3>

      <div class="d-flex justify-content-between mb-3">
        <h6 class="card-title"><%= hotel.location%></h6>
        <h6>from <b>$<%= hotel.price%> </b>per night</h6>
      </div>
      <p class="card-text"><%= hotel.description%></p>
      <ul class="list-group list-group-flush">
        <li class="list-group-item">
          Submitted by <%= hotel.author.username%>
        </li>
        <% if(hotel.date){ %>
        <li class="list-group-item"><%=hotel.date%></li>
        <% } else { %>
        <li class="list-group-item">2 days ago</li>
        <% } %>
      </ul>

      <% if(currentUser && hotel.author.equals(currentUser._id)) {%>
      <div class="card-body d-flex justify-content-end">
        <a
          class="card-link btn btn-warning button button-yellow text-white"
          href="/hotels/<%=hotel._id%>/edit"
          >Edit</a
        >
        <form
          class="d-inline"
          action="/hotels/<%=hotel._id%>?_method=DELETE"
          method="POST"
        >
          <button class="btn btn-danger button button-pink">Delete</button>
        </form>
      </div>
      <%}%>
    </div>

    <div
      class="d-flex mt-4 justify-content-md-center justify-content-lg-end col-lg-6 px-5"
    >
      <div id="map" class="map"></div>
    </div>
  </div>
  <div class="px-3 m-3 max-width-400">
    <% if(currentUser && (currentUser.username !== hotel.author.username)) {%>
    <h3 class="card-title">Leave a Review</h3>
    <form
      action="/hotels/<%=hotel._id%>/reviews"
      method="POST"
      class="mb-3 validated-form"
      novalidate
    >
      <div>
        <fieldset class="starability-basic mt-4 mb-0">
          <input
            type="radio"
            id="no-rate"
            class="input-no-rate"
            name="review[rating]"
            value="0"
            checked
            aria-label="No rating."
          />
          <input
            type="radio"
            id="first-rate1"
            name="review[rating]"
            value="1"
          />
          <label for="first-rate1" title="Terrible">1 star</label>
          <input
            type="radio"
            id="first-rate2"
            name="review[rating]"
            value="2"
          />
          <label for="first-rate2" title="Not good">2 stars</label>
          <input
            type="radio"
            id="first-rate3"
            name="review[rating]"
            value="3"
          />
          <label for="first-rate3" title="Average">3 stars</label>
          <input
            type="radio"
            id="first-rate4"
            name="review[rating]"
            value="4"
          />
          <label for="first-rate4" title="Very good">4 stars</label>
          <input
            type="radio"
            id="first-rate5"
            name="review[rating]"
            value="5"
          />
          <label for="first-rate5" title="Amazing">5 stars</label>
        </fieldset>
      </div>
      <div class="d-flex flex-column">
        <label class="form-label" for="text">Review</label>
        <textarea
          class="form-control p-2 border-blue"
          name="review[text]"
          id="text"
          cols="30"
          rows="3"
          placeholder="Your review"
          required
        ></textarea>
        <div class="valid-feedback">correctly completed</div>
      </div>
      <div class="d-flex justify-content-end mt-3">
        <button class="btn btn-success button button-blue">Submit</button>
      </div>
    </form>
    <% } %>
  </div>
  <div class="p-4 pt-0">
    <h3 class="color-pink mb-3">All Reviews</h3>
    <% if(hotel.reviews.length>0) {%> <% for(let review of hotel.reviews) {%>

    <div class="card m-3">
      <div class="card-body">
        <p class="starability-result" data-rating="<%=review.rating%>"></p>

        <p class="card-text"><%=review.text%></p>
        <h6 class="text-muted">~<%=review.author.username%></h6>

        <% if(currentUser && review.author.equals(currentUser._id)) {%>
        <form
          action="/hotels/<%=hotel._id%>/reviews/<%=review._id%>?_method=DELETE"
          method="POST"
        >
          <div class="d-flex justify-content-end">
            <button class="btn btn-sm btn-danger button button-pink bottom">
              Delete
            </button>
          </div>
        </form>
        <%}%>
      </div>
    </div>
    <% } %> <% } else {%>
    <div class="card-body">
      <p>This hotel doesn't have reviews yet.</p>
      <% } %>
    </div>
  </div>

  <script>
    const mapToken = "<%-process.env.MAPBOX_TOKEN%>";
      const hotel = <%- JSON.stringify(hotel) %>;
  </script>
  <script src="/javascript/showPageMap.js"></script>
</div>
